# Application Building Details

List of Design Patterns implemented in the project API:

- ##### Clean Architecture & DDD Patterns
- ##### Dependency Injection Pattern
- ##### Repository & Specification Patterns

  > Repository is a concept that is used in order to write the information of all entity and value objects in an aggregate to the database. The repository `Abstraction` is kept in Core, while its `Implementation` is written under the Infrastructure Layer.

---

## Clean Architecture

### Concept

    API  ->  Infrastructure

     |         |
     v         v

     Application

          |
          v

         Core

`Application` Layer:

adfasdf

`Core` Layer:

The Core Layer is responsible for storing business logic and rules, with light
(if any) implementation. In a nutshell, it represents the concept. Hence, this
layer is on top of the application.

`Infrastructure` Layer:

The Infrastructure Layer is the lowest layer of a software application,
responsible for handling communication with external resources, application
technical details and general configurations.

**Responsibilities:**

- Data access, including persistence and retrieval of entities;
- External resources access (APIs, files, messages);
- Authentication/Authorization details (JWT,);
- Implementation of interfaces defined in higher layers (Application, Core);
- Management of application dependencies and configuration;
- Logging;

Therefore, it is important that this layer be implemented in a decoupled manner
from the other layers of the application, then, it should have as few
dependencies as possible.

---

## Security

### Authentication (JWT)

---

## Error Handling

Topics covered:

- Registering handlers;
- Controlling Flow of Exceptions;
- Response Specifications.

**Registering error handlers in ASP.NET:**

1. `UseMiddleware()`:

A middleware provides a convenient mechanism for inspecting
every error, by invoking a `RequestDelegate` in a try-catch block. _Registered in Program.cs file_;

2.  `ExceptionFilterAttribute`:

A filter can be applied for a unique controller, an specific action or globally.
It's more flexible in some aspects and contexts. _Can be registered either in Program.cs or SomeController.cs files_;

3. `UseExceptionHandler("/error")`:

Built-in method with predefined behavior (basically: catch, log, reset path, and re-execute the request in an error endpoint). It receives a string path as parameter for the endpoint name. _Registered in Program.cs file and it's logic is put inside an ErrorsController.cs_.

Any of the methods mentioned above can be chosen, the best one will depend on the needs of each project.

**Flow control of exceptions in ASP.NET:**

Regardless of the approach used for registering error handlers, exceptions should gather as much relevant information as possible, and then be displayed to the user, preventing critical application information from being revealed.

These are some ways of encapsulating details of errors:

1. Via custom exceptions:

User-defined exceptions can be inherited from the `Exception` base class and an `IServiceException` interface, in order to achieve standardization across the entire application.

_Ex_.:

```cs
public interface IServiceException
{
    public HttpStatusCode StatusCode { get; }
    public string ErrorMessage { get; }
}

public class DuplicateEmailException : Exception, IServiceException
{
    public HttpStatusCode StatusCode => HttpStatusCode.Conflict;
    public string ErrorMessage => "Email already exists";
}
```

On the other hand, this way has some drawbacks. It might be harder to __track the error flow__ and __process unexpected exceptions__ in a more complex application.

2.

3.

**[RFC]("https://jsonapi.org/format/#errors") Error Specification**

> A problem details object can have the following members:
>
> - "type" (`string`) - A URI reference that identifies the problem type. This
>   specification encourages that, when dereferenced, it provide human-readable
>   documentation for the problem type (e.g., using HTML). When this member is
>   not present, its value is assumed to be "about:blank";
>
> - "title" (`string`) - A short, human-readable summary of the problem type.
>   It SHOULD NOT change from occurrence to occurrence of the problem, except for
>   purposes of localization (e.g., using proactive content negotiation);
>
> - "status" (`number`) - The HTTP status code generated by the origin server
>   for this occurrence of the problem;
>
> - "detail" (`string`) - A human-readable explanation specific to this
>   occurrence of the problem;
>
> - "instance" (`string`) - A URI reference that identifies the specific
>   occurrence of the problem. It may or may not yield further.

_Ex_.:

```json
{
  "statusCode": "409",
  "title": ""
}
```

`ProblemDetails`